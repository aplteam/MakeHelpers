 R←Test_API_017(stopFlag batchFlag);⎕TRAP;noOf;parms;res;cfg;public
⍝ Exercise CreateAPIfromCFG which calls CreateAPI under the hood
 ⎕TRAP←(999 'C' '. ⍝ Deliberate error')(0 'N')
 R←T._Failed

 #.⎕SHADOW'TEMP'
 'TEMP'#.⎕NS''
 parms←⎕SE.Cider.CreateOpenParms ⍬
 parms.folder←##.CiderConfig.HOME,'/Tests/FilesAndDirs'
 parms.parent←#.TEMP
 parms.noPkgLoad←1
 parms.importFlag←1
 parms.ignoreUserExec←1
 ⎕SE.⎕SE.Cider.##.CommTools.YesOrNo_Answers←1 2⍴'ChangeCurrentDir@' 'n'
 res←⎕SE.Cider.OpenProject parms
 cfg←⎕SE.Tatin.ReadPackageConfigFile ##.TatinVars.HOME
 noOf←##.MakeHelpers.CreateAPIfromCFG #.TEMP.FilesAndDirs.FilesAndDirs cfg
 public←#.TEMP.FilesAndDirs.FilesAndDirs.#.TEMP.FilesAndDirs.FilesAndDirs.Public
 Assert noOf=≢public
 Assert</≢¨public((⊂'Public')~⍨' '~⍨¨↓#.TEMP.FilesAndDirs.FilesAndDirs.⎕NL 3 4)
 #.TEMP.FilesAndDirs.FilesAndDirs.∆GlobalVars←42
 →T.GoToTidyUp 0≥#.TEMP.FilesAndDirs.FilesAndDirs.⎕NC'∆GlobalVars'
 #.TEMP.FilesAndDirs.FilesAndDirs.API.Dispose
 →T.GoToTidyUp 0≠#.TEMP.FilesAndDirs.FilesAndDirs.⎕NC'∆GlobalVars'

 R←T._OK

∆TidyUp:
 ⎕SE.⎕SE.Cider.##.CommTools.Cleanup
⍝Done
